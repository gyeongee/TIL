### AI Agent
- 사람의 도움 없이도 작업이나 질문을 이해하고 응답할 수 있는 스마트 시스템
- 머신러닝과 자연어처리(NLP)를 사용하여 기본적인 질문에 대한 답변부터 복잡한 프로세스 관리에 이르기까지 다양한 작업을 처리
- 의사결정을 내리고, 환경과 상화작용
#### AI 에이전트의 작동 방식
- 인식 단계 : AI 에이전트가 다양한 소스에서 정보를 수집하여 현재 상황을 파악
- 의사결정 단계 : 수집한 정보를 바탕으로 알고리즘을 사용하여 상황을 분석하고 최선의 조치를 결정
- 행동(실행) 단계: 일단 결정을 내리면 질문에 답하거나 작업을 완료하거나 사람이 처리할 수 있도록 문제를 플래그 지정하는 등 결정을 실행에 옮김

### 간단한 Vision Agent 구현
#### 인식 단계
- VisionPerception 클래스는 YOLO 모델을 이용해 입력 이미지에서 객체를 검출하고, 각 객체의 클래스 이름과 신뢰도를 반환함
```
from ultralytics import YOLO

# 객체 검출 및 인식 클래스
class VisionPerception:
    # 생성자: YOLO 모델을 불러옵니다.
    def __init__(self, model_path="/model/yolo12n.pt"):
        self.model = YOLO(model_path)

    # 객체 검출 및 인식 함수
    def detect_object(self, image):
        # YOLO에 이미지를 입력해서 객체 검출/인식 수행
        results = self.model(image)[0]

        detections = []

        # 검출된 전체 객체에 대해 반복 수행
        for box in results.boxes:
            # 검출된 객체의 클래스 ID 추출 (가장 높은 신뢰도를 가진 첫 번째 값)
            cls_id = int(box.cls[0].item())
            # 클래스 ID에 해당하는 라벨 이름 추출
            label = self.model.names[cls_id]
            # 객체 검출 신뢰도 추출
            conf = float(box.conf[0].item())

            # 라벨과 신뢰도를 딕셔너리 형태로 저장
            detections.append({'label': label, "confidence": conf})

        # 전체 검출 결과와 YOLO 결과 객체 반환
        return detections, results
```
#### 의사결정단계(Decision-making)
- DecisionMaker 클래스는 검출 결과를 받아 설정한 객체(target)가 신뢰도 기준(threshold) 이상으로 검출되었는지 판단하고, 이에 따라 메시지를 생성합니다.
  
```
# 의사결정 클래스
class DecisionMaker:
    # 생성자: 검출할 객체명(target)과 신뢰도 기준(threshold) 설정
    def __init__(self, target="person", threshold=0.5):
        self.target = target
        self.threshold = threshold

    # 검출 결과를 기반으로 의사결정 수행
    # detections : [{'label': 클래스명, 'confidence': 신뢰도}, ...]
    def make_decision(self, detections):
        # 모든 검출 결과에 대해 반복
        for d in detections:
            # 설정한 객체가 검출되고, 신뢰도가 기준 이상이면
            if d["label"] == self.target and d["confidence"] >= self.threshold:
                return f"{self.target}이 감지되었습니다."  # 검출 메시지 반환

        # 대상 객체가 기준 이하이거나 검출되지 않은 경우
        return f"{self.target}이 감지되지않았습니다."
```
#### 행동 단계(Ation)
- AgentAction 클래스는 의사결정 단계의 메시지와 인식 결과를 받아, 알람을 출력하고 설정한 타겟 객체에 대해 이미지에 바운딩박스를 표시하는 행동을 수행함
```
import matplotlib.pyplot as plt
import cv2

# 행동 단계 클래스
class AgentAction:
    # 생성자: 행동할 타겟 객체 설정
    def __init__(self, target):
        self.target = target

    # 행동 수행 함수
    # decision_message : 의사결정 단계에서 보낸 메시지
    # show_image : 이미지 출력 여부
    # results : 인식 단계에서 보낸 검출 결과
    def act(self, decision_message, show_image=True, results=None):
        # 의사결정 메시지 출력
        print(decision_message)

        # "감지되었습니다" 메시지가 있으면 알람 출력
        if "감지되었습니다" in decision_message:
            print("알람 사운드 '삐뽀삐뽀'")  # 경보 행동

        # 이미지 출력 여부 확인 및 results 존재 시 이미지 처리
        if show_image and results is not None:
            # 원본 이미지 복사
            img = results.orig_img.copy()

            # 결과에서 라벨, 신뢰도, 바운딩박스 추출
            for box in results.boxes:
                cls_id = int(box.cls[0].item())
                label = results.names[cls_id]
                conf = float(box.conf[0].item())

                # 설정한 타겟 객체만 시각화, 신뢰도 0.3 이상
                if label == self.target and conf >= 0.3:
                    x1, y1, x2, y2 = map(int, box.xyxy[0])
                    cv2.rectangle(img, (x1, y1), (x2, y2), (0, 255, 0), 2)
                    cv2.putText(img, f"{label}{conf:.2f}", (x1, y1-10),
                                cv2.FONT_HERSHEY_SIMPLEX, 0.5, (255, 0, 0), 2)

            # BGR -> RGB 변환 후 이미지 출력
            img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
            plt.figure(figsize=(10, 6))
            plt.title(f"target: {self.target}")
            plt.imshow(img_rgb)
            plt.axis('off')
            plt.show()
```
#### 에이전트 실행
```
import cv2

def run_vision_agent(image_path,target):
  # 1. 인식단계
  vp=VisionPerception()
  img = cv2.imread(image_path)
  detections,results=vp.detect_object(img)

  # 2. 의사결정단계
  dm=DecisionMaker(target=target,threshold=0.3)
  decision_message=dm.make_decision(detections)

  # 행동단계
  aa=AgentAction(target=target)
  aa.act(decision_message,show_image=True, results=results)
```
```
run_vision_agent("./data (2) (2)/fruit.png",target="orange")
```
[ 결과 ]
![alt text](image-2.png)

